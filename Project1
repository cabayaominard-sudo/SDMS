<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SDMS ‚Äî Student Driver Monitoring System | Calinog, Iloilo</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Mono:wght@400;500&family=Syne:wght@700;800&display=swap');

  :root {
    --navy: #0A2240;
    --teal: #028090;
    --teal2: #00A896;
    --teal-light: #E0F4F6;
    --red: #C0392B;
    --red-light: #FDECEA;
    --amber: #E8A020;
    --amber-light: #FDF3DC;
    --green: #1A7F5A;
    --green-light: #E6F5EF;
    --white: #FFFFFF;
    --bg: #F0F4F8;
    --bg2: #E8EDF3;
    --card: #FFFFFF;
    --text: #1A2433;
    --text2: #4A5568;
    --text3: #8A96A8;
    --border: #D8E2EE;
    --shadow: 0 2px 12px rgba(10,34,64,0.08);
    --shadow-lg: 0 8px 32px rgba(10,34,64,0.14);
    --radius: 12px;
    --radius-sm: 8px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ */
  .sidebar {
    width: 260px;
    min-height: 100vh;
    background: var(--navy);
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0; bottom: 0;
    z-index: 100;
    transition: transform 0.3s ease;
  }

  .sidebar-logo {
    padding: 28px 24px 20px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .sidebar-logo .logo-badge {
    display: inline-flex; align-items: center; gap: 10px;
  }
  .logo-icon {
    width: 40px; height: 40px; background: var(--teal);
    border-radius: 10px; display: flex; align-items: center; justify-content: center;
    font-size: 20px;
  }
  .logo-text { font-family: 'Syne', sans-serif; color: #fff; font-size: 16px; font-weight: 800; line-height: 1.1; }
  .logo-sub { color: rgba(255,255,255,0.45); font-size: 11px; font-weight: 400; margin-top: 2px; }

  .sidebar-user {
    padding: 16px 24px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    display: flex; align-items: center; gap: 12px;
  }
  .user-avatar {
    width: 36px; height: 36px; border-radius: 50%;
    background: linear-gradient(135deg, var(--teal), var(--teal2));
    display: flex; align-items: center; justify-content: center;
    color: white; font-size: 14px; font-weight: 700; flex-shrink: 0;
  }
  .user-info { flex: 1; min-width: 0; }
  .user-name { color: #fff; font-size: 13px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .user-role { color: var(--teal2); font-size: 11px; }
  .role-switch {
    display: flex; gap: 4px; padding: 16px 24px;
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }
  .role-btn {
    flex: 1; padding: 7px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.15);
    background: transparent; color: rgba(255,255,255,0.5); font-size: 11px; font-weight: 600;
    cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif;
  }
  .role-btn.active { background: var(--teal); border-color: var(--teal); color: white; }

  .sidebar-nav { flex: 1; padding: 12px 0; overflow-y: auto; }
  .nav-section { padding: 8px 24px 4px; font-size: 10px; font-weight: 600; color: rgba(255,255,255,0.3); letter-spacing: 1.2px; text-transform: uppercase; }
  .nav-item {
    display: flex; align-items: center; gap: 12px;
    padding: 10px 24px; cursor: pointer; transition: all 0.2s;
    color: rgba(255,255,255,0.6); font-size: 13.5px; font-weight: 500;
    position: relative;
  }
  .nav-item:hover { background: rgba(255,255,255,0.06); color: #fff; }
  .nav-item.active { background: rgba(2,128,144,0.2); color: #fff; }
  .nav-item.active::before {
    content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
    width: 3px; height: 24px; background: var(--teal2); border-radius: 0 3px 3px 0;
  }
  .nav-icon { font-size: 16px; width: 20px; text-align: center; }
  .nav-badge {
    margin-left: auto; background: var(--red); color: white;
    font-size: 10px; font-weight: 700; padding: 2px 7px; border-radius: 20px;
  }
  .nav-badge.green { background: var(--green); }

  .sidebar-footer {
    padding: 16px 24px;
    border-top: 1px solid rgba(255,255,255,0.08);
  }
  .app-version { font-size: 10px; color: rgba(255,255,255,0.25); }

  /* ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ */
  .main {
    margin-left: 260px;
    flex: 1;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
  .topbar {
    height: 64px;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 28px;
    position: sticky; top: 0; z-index: 50;
  }
  .topbar-left { display: flex; align-items: center; gap: 16px; }
  .page-title { font-family: 'Syne', sans-serif; font-size: 18px; font-weight: 800; color: var(--navy); }
  .page-sub { font-size: 12px; color: var(--text3); margin-top: 2px; }
  .topbar-right { display: flex; align-items: center; gap: 12px; }

  .emergency-btn {
    display: flex; align-items: center; gap: 8px;
    background: var(--red); color: white;
    border: none; border-radius: 10px; padding: 9px 18px;
    font-size: 13px; font-weight: 700; cursor: pointer;
    animation: pulse-red 2s infinite;
    font-family: 'DM Sans', sans-serif;
    transition: transform 0.1s;
  }
  .emergency-btn:hover { transform: scale(1.04); }
  @keyframes pulse-red {
    0%, 100% { box-shadow: 0 0 0 0 rgba(192,57,43,0.4); }
    50% { box-shadow: 0 0 0 8px rgba(192,57,43,0); }
  }

  .notif-btn {
    position: relative; background: var(--bg); border: 1px solid var(--border);
    border-radius: 10px; width: 38px; height: 38px; display: flex; align-items: center;
    justify-content: center; cursor: pointer; font-size: 16px; transition: all 0.2s;
  }
  .notif-btn:hover { background: var(--teal-light); border-color: var(--teal); }
  .notif-dot {
    position: absolute; top: 6px; right: 6px; width: 8px; height: 8px;
    background: var(--red); border-radius: 50%; border: 2px solid var(--card);
  }
  .live-indicator {
    display: flex; align-items: center; gap: 6px;
    background: var(--green-light); border: 1px solid #A8DFCA;
    border-radius: 20px; padding: 5px 12px; font-size: 11.5px; font-weight: 600; color: var(--green);
  }
  .live-dot { width: 7px; height: 7px; background: var(--green); border-radius: 50%; animation: blink 1.2s infinite; }
  @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:0.3;} }

  /* ‚îÄ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ‚îÄ */
  .content { padding: 28px; flex: 1; }
  .content.hidden { display: none; }

  /* ‚îÄ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ‚îÄ */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px; margin-bottom: 24px;
  }
  .stat-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    position: relative; overflow: hidden;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
  .stat-card::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  }
  .stat-card.teal::after { background: var(--teal); }
  .stat-card.green::after { background: var(--green); }
  .stat-card.amber::after { background: var(--amber); }
  .stat-card.red::after { background: var(--red); }

  .stat-label { font-size: 11.5px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; }
  .stat-value { font-family: 'Syne', sans-serif; font-size: 32px; font-weight: 800; color: var(--navy); line-height: 1; }
  .stat-value.safe { color: var(--green); }
  .stat-value.warning { color: var(--amber); }
  .stat-value.danger { color: var(--red); }
  .stat-meta { font-size: 11.5px; color: var(--text3); margin-top: 8px; display: flex; align-items: center; gap: 4px; }
  .stat-icon { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); font-size: 36px; opacity: 0.08; }

  /* ‚îÄ‚îÄ‚îÄ GRID LAYOUT ‚îÄ‚îÄ‚îÄ */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
  .grid-3-1 { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
  .grid-2-1 { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; margin-bottom: 20px; }

  /* ‚îÄ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ‚îÄ */
  .card {
    background: var(--card);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    overflow: hidden;
  }
  .card-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
  }
  .card-title { font-weight: 700; font-size: 14px; color: var(--navy); display: flex; align-items: center; gap: 8px; }
  .card-body { padding: 20px; }
  .card-action {
    font-size: 12px; color: var(--teal); font-weight: 600; cursor: pointer;
    padding: 6px 12px; border-radius: 8px; border: 1px solid var(--teal-light);
    background: var(--teal-light); transition: all 0.2s;
  }
  .card-action:hover { background: var(--teal); color: white; }

  /* ‚îÄ‚îÄ‚îÄ MAP SIMULATION ‚îÄ‚îÄ‚îÄ */
  .map-container {
    height: 320px;
    background: #E8EDF3;
    border-radius: var(--radius-sm);
    position: relative;
    overflow: hidden;
  }
  .map-bg {
    width: 100%; height: 100%;
    background:
      repeating-linear-gradient(0deg, transparent, transparent 40px, rgba(2,128,144,0.06) 40px, rgba(2,128,144,0.06) 41px),
      repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(2,128,144,0.06) 40px, rgba(2,128,144,0.06) 41px),
      linear-gradient(135deg, #D6E4F0 0%, #E8EDF3 50%, #D0E8E4 100%);
    position: relative;
  }
  /* Road lines */
  .map-road-h {
    position: absolute; left: 0; right: 0; height: 12px;
    background: rgba(255,255,255,0.7); border-top: 1px solid rgba(255,255,255,0.9); border-bottom: 1px solid rgba(255,255,255,0.9);
  }
  .map-road-v {
    position: absolute; top: 0; bottom: 0; width: 12px;
    background: rgba(255,255,255,0.7); border-left: 1px solid rgba(255,255,255,0.9); border-right: 1px solid rgba(255,255,255,0.9);
  }
  .map-label {
    position: absolute; background: rgba(10,34,64,0.75); color: #fff;
    font-size: 9px; font-weight: 600; padding: 2px 6px; border-radius: 4px;
    pointer-events: none; white-space: nowrap;
  }
  /* Driver pin */
  .driver-pin {
    position: absolute;
    display: flex; flex-direction: column; align-items: center;
    animation: drive-anim 8s linear infinite;
  }
  @keyframes drive-anim {
    0%   { left: 15%; top: 55%; }
    25%  { left: 40%; top: 40%; }
    50%  { left: 65%; top: 55%; }
    75%  { left: 40%; top: 68%; }
    100% { left: 15%; top: 55%; }
  }
  .pin-circle {
    width: 36px; height: 36px; background: var(--teal); border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    border: 3px solid white; box-shadow: 0 2px 12px rgba(2,128,144,0.5);
    font-size: 16px; color: white;
    animation: pin-pulse 1.5s ease infinite;
  }
  @keyframes pin-pulse {
    0%,100% { box-shadow: 0 0 0 0 rgba(2,128,144,0.5), 0 2px 8px rgba(2,128,144,0.4); }
    50% { box-shadow: 0 0 0 12px rgba(2,128,144,0), 0 2px 8px rgba(2,128,144,0.4); }
  }
  .pin-label {
    margin-top: 4px; background: var(--navy); color: white;
    font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px;
    white-space: nowrap;
  }
  /* Route trail */
  .route-trail {
    position: absolute; left: 10%; top: 20%; width: 80%; height: 60%;
    border: 2px dashed var(--teal); border-radius: 40px; opacity: 0.3;
  }
  /* Speed overlay */
  .map-overlay {
    position: absolute; bottom: 12px; left: 12px; right: 12px;
    display: flex; gap: 8px;
  }
  .map-chip {
    background: rgba(10,34,64,0.85); color: white;
    padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 600;
    display: flex; align-items: center; gap: 6px; backdrop-filter: blur(4px);
  }
  .map-chip .dot { width: 7px; height: 7px; border-radius: 50%; }
  .map-chip .dot.green { background: #2ECC71; }
  .map-chip .dot.amber { background: var(--amber); }

  /* ‚îÄ‚îÄ‚îÄ ALERT FEED ‚îÄ‚îÄ‚îÄ */
  .alert-feed { max-height: 320px; overflow-y: auto; }
  .alert-item {
    display: flex; gap: 12px; padding: 14px 20px;
    border-bottom: 1px solid var(--border);
    transition: background 0.2s;
    align-items: flex-start;
  }
  .alert-item:hover { background: var(--bg); }
  .alert-item:last-child { border-bottom: none; }
  .alert-icon-wrap {
    width: 36px; height: 36px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
  }
  .alert-icon-wrap.red { background: var(--red-light); }
  .alert-icon-wrap.amber { background: var(--amber-light); }
  .alert-icon-wrap.green { background: var(--green-light); }
  .alert-icon-wrap.teal { background: var(--teal-light); }
  .alert-content { flex: 1; }
  .alert-title { font-size: 13px; font-weight: 600; color: var(--text); }
  .alert-desc { font-size: 11.5px; color: var(--text2); margin-top: 2px; line-height: 1.4; }
  .alert-time { font-size: 10.5px; color: var(--text3); white-space: nowrap; font-family: 'DM Mono', monospace; }

  /* ‚îÄ‚îÄ‚îÄ DRIVER TABLE ‚îÄ‚îÄ‚îÄ */
  .driver-table { width: 100%; border-collapse: collapse; }
  .driver-table th {
    text-align: left; padding: 10px 16px;
    font-size: 11px; font-weight: 700; color: var(--text3);
    text-transform: uppercase; letter-spacing: 0.8px;
    border-bottom: 1px solid var(--border); background: var(--bg);
  }
  .driver-table td { padding: 12px 16px; font-size: 13px; border-bottom: 1px solid var(--border); }
  .driver-table tr:last-child td { border-bottom: none; }
  .driver-table tr:hover td { background: var(--bg); }

  .status-pill {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700;
  }
  .status-pill.driving { background: var(--green-light); color: var(--green); }
  .status-pill.parked { background: var(--teal-light); color: var(--teal); }
  .status-pill.offline { background: var(--bg2); color: var(--text3); }
  .status-pill.alert { background: var(--red-light); color: var(--red); }
  .status-pill::before { content: '‚óè'; font-size: 8px; }

  .speed-bar-wrap { width: 80px; }
  .speed-bar-bg { width: 100%; height: 6px; background: var(--border); border-radius: 3px; margin-top: 3px; }
  .speed-bar { height: 6px; border-radius: 3px; transition: width 1s; }
  .speed-bar.safe { background: var(--green); }
  .speed-bar.warning { background: var(--amber); }
  .speed-bar.danger { background: var(--red); }

  .score-badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 36px; height: 36px; border-radius: 50%; font-size: 12px; font-weight: 800;
    font-family: 'Syne', sans-serif;
  }
  .score-badge.A { background: var(--green-light); color: var(--green); }
  .score-badge.B { background: var(--teal-light); color: var(--teal); }
  .score-badge.C { background: var(--amber-light); color: var(--amber); }
  .score-badge.D { background: var(--red-light); color: var(--red); }

  /* ‚îÄ‚îÄ‚îÄ SPEED CHART ‚îÄ‚îÄ‚îÄ */
  .chart-wrap { padding: 16px 20px 8px; }
  canvas { width: 100% !important; }

  /* ‚îÄ‚îÄ‚îÄ TRIP HISTORY ‚îÄ‚îÄ‚îÄ */
  .trip-item {
    display: flex; align-items: center; gap: 14px;
    padding: 14px 20px; border-bottom: 1px solid var(--border);
    transition: background 0.2s;
  }
  .trip-item:hover { background: var(--bg); }
  .trip-item:last-child { border-bottom: none; }
  .trip-icon {
    width: 40px; height: 40px; border-radius: 10px; background: var(--teal-light);
    display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0;
  }
  .trip-info { flex: 1; }
  .trip-name { font-size: 13px; font-weight: 600; color: var(--text); }
  .trip-meta { font-size: 11.5px; color: var(--text3); margin-top: 2px; }
  .trip-stats { text-align: right; }
  .trip-dist { font-size: 14px; font-weight: 700; color: var(--navy); }
  .trip-dur { font-size: 11px; color: var(--text3); margin-top: 2px; }
  .trip-score { font-size: 12px; font-weight: 700; padding: 3px 8px; border-radius: 6px; }
  .trip-score.good { background: var(--green-light); color: var(--green); }
  .trip-score.ok { background: var(--amber-light); color: var(--amber); }
  .trip-score.bad { background: var(--red-light); color: var(--red); }

  /* ‚îÄ‚îÄ‚îÄ QUICK ACTIONS ‚îÄ‚îÄ‚îÄ */
  .quick-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 16px; }
  .action-btn {
    display: flex; align-items: center; gap: 10px;
    padding: 12px 14px; border-radius: var(--radius-sm);
    border: 1.5px solid var(--border); background: var(--bg);
    cursor: pointer; transition: all 0.2s; font-family: 'DM Sans', sans-serif;
    font-size: 12.5px; font-weight: 600; color: var(--text2);
  }
  .action-btn:hover { border-color: var(--teal); background: var(--teal-light); color: var(--teal); }
  .action-btn .ab-icon { font-size: 20px; }

  /* ‚îÄ‚îÄ‚îÄ NOTIFICATION PANEL ‚îÄ‚îÄ‚îÄ */
  .notif-panel {
    position: fixed; top: 64px; right: 20px; width: 360px;
    background: var(--card); border-radius: var(--radius);
    border: 1px solid var(--border); box-shadow: var(--shadow-lg);
    z-index: 200; display: none; max-height: 80vh; overflow-y: auto;
  }
  .notif-panel.open { display: block; animation: fadeDown 0.2s ease; }
  @keyframes fadeDown { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }
  .notif-header { padding: 14px 18px; border-bottom: 1px solid var(--border); font-weight: 700; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
  .notif-clear { font-size: 11px; color: var(--teal); cursor: pointer; font-weight: 600; }

  /* ‚îÄ‚îÄ‚îÄ EMERGENCY MODAL ‚îÄ‚îÄ‚îÄ */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(10,34,64,0.7);
    z-index: 300; display: none; align-items: center; justify-content: center;
  }
  .modal-overlay.open { display: flex; animation: fadeIn 0.2s; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .modal {
    background: var(--card); border-radius: 20px; padding: 36px;
    max-width: 440px; width: 90%; text-align: center;
    animation: scaleIn 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes scaleIn { from { transform: scale(0.85); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  .modal-icon { font-size: 56px; margin-bottom: 16px; }
  .modal-title { font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 800; color: var(--red); margin-bottom: 8px; }
  .modal-desc { font-size: 14px; color: var(--text2); line-height: 1.6; margin-bottom: 24px; }
  .modal-actions { display: flex; gap: 12px; }
  .modal-btn {
    flex: 1; padding: 12px; border-radius: 12px; font-size: 14px; font-weight: 700;
    cursor: pointer; border: none; font-family: 'DM Sans', sans-serif; transition: all 0.2s;
  }
  .modal-btn.primary { background: var(--red); color: white; }
  .modal-btn.primary:hover { filter: brightness(1.1); }
  .modal-btn.secondary { background: var(--bg); color: var(--text2); border: 1px solid var(--border); }
  .modal-detail { background: var(--red-light); border-radius: 10px; padding: 14px; margin-bottom: 24px; text-align: left; }
  .modal-detail-row { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 6px; }
  .modal-detail-row:last-child { margin-bottom: 0; }
  .modal-detail-key { color: var(--text3); }
  .modal-detail-val { font-weight: 600; color: var(--text); }

  /* ‚îÄ‚îÄ‚îÄ SETTINGS PAGE ‚îÄ‚îÄ‚îÄ */
  .settings-section { margin-bottom: 24px; }
  .settings-title { font-size: 13px; font-weight: 700; color: var(--navy); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.8px; }
  .setting-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 14px 20px; border-bottom: 1px solid var(--border);
  }
  .setting-row:last-child { border-bottom: none; }
  .setting-info { flex: 1; }
  .setting-label { font-size: 13.5px; font-weight: 600; color: var(--text); }
  .setting-desc { font-size: 12px; color: var(--text3); margin-top: 2px; }
  .toggle {
    width: 44px; height: 24px; background: var(--border);
    border-radius: 12px; cursor: pointer; transition: background 0.3s;
    position: relative; flex-shrink: 0;
  }
  .toggle.on { background: var(--teal); }
  .toggle::after {
    content: ''; position: absolute; width: 18px; height: 18px;
    background: white; border-radius: 50%; top: 3px; left: 3px;
    transition: left 0.3s; box-shadow: 0 1px 4px rgba(0,0,0,0.2);
  }
  .toggle.on::after { left: 23px; }
  .setting-input {
    width: 100px; padding: 7px 12px; border: 1.5px solid var(--border);
    border-radius: 8px; font-size: 13px; font-family: 'DM Mono', monospace;
    background: var(--bg); color: var(--text); text-align: right;
    transition: border-color 0.2s;
  }
  .setting-input:focus { outline: none; border-color: var(--teal); }

  /* ‚îÄ‚îÄ‚îÄ REPORTS PAGE ‚îÄ‚îÄ‚îÄ */
  .report-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 24px; }
  .report-card {
    background: var(--card); border-radius: var(--radius); border: 1px solid var(--border);
    padding: 20px; text-align: center; transition: all 0.2s;
  }
  .report-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }
  .report-num { font-family: 'Syne', sans-serif; font-size: 42px; font-weight: 800; color: var(--navy); }
  .report-unit { font-size: 13px; color: var(--text3); margin-bottom: 4px; }
  .report-label { font-size: 12px; font-weight: 600; color: var(--text2); }
  .report-trend { font-size: 11px; margin-top: 6px; }
  .report-trend.up { color: var(--green); }
  .report-trend.down { color: var(--red); }

  /* ‚îÄ‚îÄ‚îÄ DRIVER PROFILE ‚îÄ‚îÄ‚îÄ */
  .profile-header {
    background: linear-gradient(135deg, var(--navy) 0%, #1a3a5c 100%);
    padding: 28px; border-radius: var(--radius) var(--radius) 0 0;
    display: flex; align-items: center; gap: 20px;
  }
  .profile-avatar {
    width: 72px; height: 72px; border-radius: 50%;
    background: linear-gradient(135deg, var(--teal), var(--teal2));
    display: flex; align-items: center; justify-content: center;
    font-size: 28px; color: white; font-weight: 700; font-family: 'Syne', sans-serif;
    border: 3px solid rgba(255,255,255,0.2);
  }
  .profile-name { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800; color: white; }
  .profile-meta { font-size: 13px; color: rgba(255,255,255,0.6); margin-top: 4px; }
  .profile-tag {
    display: inline-block; background: var(--teal); color: white;
    font-size: 10px; font-weight: 700; padding: 3px 9px; border-radius: 20px; margin-top: 6px;
  }
  .profile-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; background: var(--border); border-top: 1px solid var(--border); }
  .profile-stat { padding: 16px; background: var(--card); text-align: center; }
  .profile-stat-val { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800; color: var(--navy); }
  .profile-stat-label { font-size: 11px; color: var(--text3); margin-top: 4px; }

  /* ‚îÄ‚îÄ‚îÄ REGISTER FORM ‚îÄ‚îÄ‚îÄ */
  .form-group { margin-bottom: 16px; }
  .form-label { font-size: 12px; font-weight: 700; color: var(--text2); text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 6px; display: block; }
  .form-input {
    width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
    border-radius: var(--radius-sm); font-size: 14px; font-family: 'DM Sans', sans-serif;
    background: var(--bg); color: var(--text); transition: border-color 0.2s;
  }
  .form-input:focus { outline: none; border-color: var(--teal); background: white; }
  .form-select {
    width: 100%; padding: 10px 14px; border: 1.5px solid var(--border);
    border-radius: var(--radius-sm); font-size: 14px; font-family: 'DM Sans', sans-serif;
    background: var(--bg); color: var(--text); appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%234A5568' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-position: right 12px center;
  }
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .btn-primary {
    width: 100%; padding: 12px; background: var(--teal);
    color: white; border: none; border-radius: var(--radius-sm);
    font-size: 14px; font-weight: 700; font-family: 'DM Sans', sans-serif;
    cursor: pointer; transition: all 0.2s; margin-top: 8px;
  }
  .btn-primary:hover { background: var(--teal2); transform: translateY(-1px); }

  /* ‚îÄ‚îÄ‚îÄ OOP DIAGRAM ‚îÄ‚îÄ‚îÄ */
  .oop-diagram { padding: 20px; }
  .oop-class {
    background: var(--bg); border: 2px solid var(--border); border-radius: var(--radius-sm);
    margin-bottom: 12px; overflow: hidden;
  }
  .oop-class-header {
    padding: 10px 16px; font-size: 12px; font-weight: 800; font-family: 'DM Mono', monospace;
    display: flex; align-items: center; gap: 8px;
  }
  .oop-class-header.abstract { background: var(--navy); color: white; }
  .oop-class-header.concrete { background: var(--teal); color: white; }
  .oop-class-header.singleton { background: var(--red); color: white; }
  .oop-class-body { padding: 10px 16px; font-size: 11px; font-family: 'DM Mono', monospace; color: var(--text2); line-height: 1.8; }
  .oop-method { color: var(--teal); }
  .oop-attr { color: var(--amber); }
  .oop-arrow { text-align: center; color: var(--text3); font-size: 18px; margin: -4px 0; }

  /* ‚îÄ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ‚îÄ */
  ::-webkit-scrollbar { width: 6px; height: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
  ::-webkit-scrollbar-thumb:hover { background: var(--text3); }

  /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
  .toast-container { position: fixed; bottom: 24px; right: 24px; z-index: 500; display: flex; flex-direction: column; gap: 10px; }
  .toast {
    background: var(--navy); color: white; padding: 14px 18px;
    border-radius: 12px; font-size: 13px; font-weight: 500;
    display: flex; align-items: center; gap: 10px;
    box-shadow: var(--shadow-lg); min-width: 280px;
    animation: toastIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    border-left: 4px solid var(--teal2);
  }
  @keyframes toastIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
  .toast.error { border-left-color: var(--red); }
  .toast.warning { border-left-color: var(--amber); }
  .toast.success { border-left-color: var(--green); }

  /* ‚îÄ‚îÄ‚îÄ BADGE TAG ‚îÄ‚îÄ‚îÄ */
  .tag {
    display: inline-block; font-size: 11px; font-weight: 700; padding: 3px 9px;
    border-radius: 6px; margin-right: 4px;
  }
  .tag.blue { background: #E8F0FE; color: #2962FF; }
  .tag.teal { background: var(--teal-light); color: var(--teal); }
  .tag.red { background: var(--red-light); color: var(--red); }
  .tag.green { background: var(--green-light); color: var(--green); }
  .tag.amber { background: var(--amber-light); color: var(--amber); }

  /* ‚îÄ‚îÄ‚îÄ RESPONSIVE HEADER DETAIL ‚îÄ‚îÄ‚îÄ */
  .detail-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 4px; }
  .chip {
    background: var(--bg); border: 1px solid var(--border);
    border-radius: 20px; padding: 4px 12px;
    font-size: 11.5px; color: var(--text2); font-weight: 500;
    display: flex; align-items: center; gap: 5px;
  }

  /* Gauge */
  .gauge-wrap { display: flex; justify-content: center; padding: 12px 0 0; }
  .gauge { position: relative; width: 140px; height: 80px; }
  .gauge svg { width: 140px; height: 80px; overflow: visible; }
  .gauge-value {
    position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
    font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 800; color: var(--navy);
    white-space: nowrap;
  }
  .gauge-label { text-align: center; font-size: 11px; color: var(--text3); margin-top: 6px; }
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ -->
<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-badge">
      <div class="logo-icon">üöó</div>
      <div>
        <div class="logo-text">SDMS</div>
        <div class="logo-sub">Student Driver Monitor</div>
      </div>
    </div>
  </div>

  <div class="sidebar-user">
    <div class="user-avatar" id="userAvatarSidebar">JD</div>
    <div class="user-info">
      <div class="user-name" id="userNameSidebar">Jane Doe</div>
      <div class="user-role" id="userRoleSidebar">Parent / Guardian</div>
    </div>
  </div>

  <div class="role-switch">
    <button class="role-btn active" id="btnParent" onclick="switchRole('parent')">üë®‚Äçüë©‚Äçüë¶ Parent</button>
    <button class="role-btn" id="btnDriver" onclick="switchRole('driver')">üöó Driver</button>
  </div>

  <nav class="sidebar-nav">
    <div class="nav-section">Monitor</div>
    <div class="nav-item active" onclick="showPage('dashboard')">
      <span class="nav-icon">üìä</span> Dashboard
    </div>
    <div class="nav-item" onclick="showPage('livetrack')">
      <span class="nav-icon">üìç</span> Live Tracking
    </div>
    <div class="nav-item" onclick="showPage('alerts')">
      <span class="nav-icon">üîî</span> Alerts
      <span class="nav-badge" id="alertBadge">3</span>
    </div>

    <div class="nav-section">Data</div>
    <div class="nav-item" onclick="showPage('trips')">
      <span class="nav-icon">üó∫Ô∏è</span> Trip History
    </div>
    <div class="nav-item" onclick="showPage('reports')">
      <span class="nav-icon">üìà</span> Reports
    </div>

    <div class="nav-section">Manage</div>
    <div class="nav-item" onclick="showPage('drivers')">
      <span class="nav-icon">üë§</span> Drivers
      <span class="nav-badge green" id="driversBadge">2</span>
    </div>
    <div class="nav-item" onclick="showPage('register')">
      <span class="nav-icon">‚ûï</span> Register Driver
    </div>

    <div class="nav-section">System</div>
    <div class="nav-item" onclick="showPage('oop')">
      <span class="nav-icon">üèóÔ∏è</span> OOP Architecture
    </div>
    <div class="nav-item" onclick="showPage('settings')">
      <span class="nav-icon">‚öôÔ∏è</span> Settings
    </div>
  </nav>

  <div class="sidebar-footer">
    <div class="app-version">SDMS v1.0 ¬∑ Calinog, Iloilo ¬∑ MITS 709</div>
  </div>
</aside>

<!-- ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ -->
<main class="main">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-left">
      <div>
        <div class="page-title" id="pageTitle">Dashboard</div>
        <div class="page-sub" id="pageSub">Overview ¬∑ Calinog, Iloilo</div>
      </div>
    </div>
    <div class="topbar-right">
      <div class="live-indicator">
        <div class="live-dot"></div>
        LIVE
      </div>
      <div class="notif-btn" onclick="toggleNotif()" id="notifBtn">
        üîî
        <div class="notif-dot" id="notifDot"></div>
      </div>
      <button class="emergency-btn" onclick="openEmergency()">
        üÜò EMERGENCY
      </button>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: DASHBOARD ‚îÄ‚îÄ‚îÄ -->
  <div class="content" id="page-dashboard">

    <div class="stats-grid">
      <div class="stat-card teal">
        <div class="stat-label">Active Drivers</div>
        <div class="stat-value safe" id="stat-active">2</div>
        <div class="stat-meta">üü¢ Currently on road</div>
        <div class="stat-icon">üöó</div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">Avg Speed</div>
        <div class="stat-value" id="stat-speed">42 <span style="font-size:16px;font-weight:400">km/h</span></div>
        <div class="stat-meta">‚úÖ Below 60 km/h limit</div>
        <div class="stat-icon">‚ö°</div>
      </div>
      <div class="stat-card amber">
        <div class="stat-label">Alerts Today</div>
        <div class="stat-value warning" id="stat-alerts">3</div>
        <div class="stat-meta">‚ö†Ô∏è 1 speeding, 2 harsh braking</div>
        <div class="stat-icon">üîî</div>
      </div>
      <div class="stat-card red">
        <div class="stat-label">Safety Score</div>
        <div class="stat-value safe" id="stat-score">82<span style="font-size:16px;font-weight:400">%</span></div>
        <div class="stat-meta">üìä +4% from last week</div>
        <div class="stat-icon">üõ°Ô∏è</div>
      </div>
    </div>

    <div class="grid-3-1">
      <!-- Live Map -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">üìç Live Map ‚Äî Calinog, Iloilo</div>
          <div class="detail-chips">
            <div class="chip">üü¢ 2 Active</div>
            <div class="chip">üì° 10s refresh</div>
          </div>
        </div>
        <div class="card-body" style="padding:0;">
          <div class="map-container">
            <div class="map-bg">
              <!-- Roads -->
              <div class="map-road-h" style="top:35%"></div>
              <div class="map-road-h" style="top:62%"></div>
              <div class="map-road-v" style="left:30%"></div>
              <div class="map-road-v" style="left:65%"></div>
              <!-- Labels -->
              <div class="map-label" style="top:32%;left:5%">Calinog Poblacion</div>
              <div class="map-label" style="top:18%;left:60%">Brgy. Cagay</div>
              <div class="map-label" style="top:70%;left:35%">Brgy. Agcalaga</div>
              <div class="map-label" style="top:55%;left:68%">Calinog Public Mkt</div>
              <!-- Route trail -->
              <div class="route-trail"></div>
              <!-- Driver 1 (animated) -->
              <div class="driver-pin" id="pin1">
                <div class="pin-circle">üöó</div>
                <div class="pin-label">John Jr. ¬∑ 45 km/h</div>
              </div>
              <!-- Driver 2 (static position) -->
              <div class="driver-pin" style="animation:none;left:68%;top:30%;">
                <div class="pin-circle" style="background:var(--amber)">üöó</div>
                <div class="pin-label">Maria ¬∑ 58 km/h</div>
              </div>
            </div>
            <div class="map-overlay">
              <div class="map-chip"><div class="dot green"></div>John Jr. ‚Äî 45 km/h ‚Äî Normal</div>
              <div class="map-chip"><div class="dot amber"></div>Maria ‚Äî 58 km/h ‚Äî Near Limit</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">‚ö° Quick Actions</div>
        </div>
        <div class="quick-actions">
          <div class="action-btn" onclick="showToast('üìç Tracking location refreshed.','success')"><span class="ab-icon">üìç</span> Refresh Location</div>
          <div class="action-btn" onclick="showToast('üìä Report exported to PDF.','success')"><span class="ab-icon">üìä</span> Export Report</div>
          <div class="action-btn" onclick="showPage('alerts')"><span class="ab-icon">üîî</span> View Alerts</div>
          <div class="action-btn" onclick="showPage('trips')"><span class="ab-icon">üó∫Ô∏è</span> Trip History</div>
          <div class="action-btn" onclick="showPage('drivers')"><span class="ab-icon">üë§</span> Manage Drivers</div>
          <div class="action-btn" onclick="showPage('settings')"><span class="ab-icon">‚öôÔ∏è</span> Settings</div>
        </div>
        <!-- Speed Gauge for Driver 1 -->
        <div style="border-top:1px solid var(--border);padding:14px 16px 0;">
          <div style="font-size:12px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.8px;margin-bottom:8px;">John Jr. Live Speed</div>
          <div class="gauge-wrap">
            <div class="gauge">
              <svg viewBox="0 0 140 80">
                <!-- Background arc -->
                <path d="M10,75 A60,60 0 0,1 130,75" fill="none" stroke="#E8EDF3" stroke-width="12" stroke-linecap="round"/>
                <!-- Green zone -->
                <path d="M10,75 A60,60 0 0,1 84,18" fill="none" stroke="#1A7F5A" stroke-width="12" stroke-linecap="round" opacity="0.3"/>
                <!-- Speed fill (45/120 = 37.5% ‚Üí angle) -->
                <path d="M10,75 A60,60 0 0,1 67,14" fill="none" stroke="#1A7F5A" stroke-width="12" stroke-linecap="round" id="gaugeFill"/>
                <!-- Needle -->
                <line x1="70" y1="75" x2="38" y2="22" stroke="#0A2240" stroke-width="2.5" stroke-linecap="round" id="gaugeNeedle"/>
                <circle cx="70" cy="75" r="5" fill="#0A2240"/>
              </svg>
              <div class="gauge-value" id="gaugeVal">45</div>
            </div>
          </div>
          <div class="gauge-label">km/h ¬∑ Safe (‚â§60 limit)</div>
        </div>
      </div>
    </div>

    <!-- Alert feed + Drivers table -->
    <div class="grid-2">
      <div class="card">
        <div class="card-header">
          <div class="card-title">üîî Recent Alerts</div>
          <div class="card-action" onclick="showPage('alerts')">View all</div>
        </div>
        <div class="alert-feed" id="dashAlerts">
          <!-- dynamically rendered -->
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">üë§ Active Drivers</div>
          <div class="card-action" onclick="showPage('drivers')">Manage</div>
        </div>
        <div style="overflow-x:auto;">
          <table class="driver-table" id="dashDriversTable">
            <thead>
              <tr>
                <th>Driver</th>
                <th>Status</th>
                <th>Speed</th>
                <th>Score</th>
              </tr>
            </thead>
            <tbody id="dashDriversTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- /page-dashboard -->

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: LIVE TRACKING ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-livetrack">
    <div class="stats-grid">
      <div class="stat-card teal">
        <div class="stat-label">John Jr. Speed</div>
        <div class="stat-value safe" id="lt-speed1">45 <small>km/h</small></div>
        <div class="stat-meta">‚úÖ Within limit</div>
      </div>
      <div class="stat-card amber">
        <div class="stat-label">Maria Speed</div>
        <div class="stat-value warning" id="lt-speed2">58 <small>km/h</small></div>
        <div class="stat-meta">‚ö†Ô∏è Approaching limit</div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">John Jr. Distance</div>
        <div class="stat-value">7.2 <small>km</small></div>
        <div class="stat-meta">üìç Today's trip</div>
      </div>
      <div class="stat-card teal">
        <div class="stat-label">Trip Duration</div>
        <div class="stat-value" id="lt-duration">18 <small>min</small></div>
        <div class="stat-meta">üïê Since 2:14 PM</div>
      </div>
    </div>
    <div class="grid-2-1">
      <div class="card">
        <div class="card-header">
          <div class="card-title">üìç Full Map View ‚Äî Calinog, Iloilo</div>
          <div class="detail-chips">
            <div class="chip">üõ∞Ô∏è GPS Active</div>
            <div class="chip">üîÑ Auto-refresh: 10s</div>
          </div>
        </div>
        <div class="card-body" style="padding:0;">
          <div class="map-container" style="height:400px;">
            <div class="map-bg" style="height:100%;">
              <div class="map-road-h" style="top:30%"></div>
              <div class="map-road-h" style="top:55%"></div>
              <div class="map-road-h" style="top:78%"></div>
              <div class="map-road-v" style="left:25%"></div>
              <div class="map-road-v" style="left:55%"></div>
              <div class="map-road-v" style="left:80%"></div>
              <div class="map-label" style="top:10%;left:8%">Calinog Central</div>
              <div class="map-label" style="top:22%;left:55%">Brgy. Garangan</div>
              <div class="map-label" style="top:60%;left:28%">Brgy. Dalicanan</div>
              <div class="map-label" style="top:75%;left:60%">Calinog High School</div>
              <div class="map-label" style="top:42%;left:82%">Brgy. Balabag</div>
              <div class="route-trail" style="width:70%;height:50%;left:15%;top:22%;"></div>
              <div class="driver-pin">
                <div class="pin-circle">üöó</div>
                <div class="pin-label">John Jr. ¬∑ 45 km/h</div>
              </div>
              <div class="driver-pin" style="animation:none;left:58%;top:25%;">
                <div class="pin-circle" style="background:var(--amber)">üöó</div>
                <div class="pin-label">Maria ¬∑ 58 km/h</div>
              </div>
            </div>
            <div class="map-overlay">
              <div class="map-chip"><div class="dot green"></div>John Jr. ‚Äî Calinog Poblacion</div>
              <div class="map-chip"><div class="dot amber"></div>Maria ‚Äî Brgy. Garangan</div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="card" style="margin-bottom:16px;">
          <div class="card-header"><div class="card-title">üìä Speed Chart</div></div>
          <div class="chart-wrap">
            <canvas id="speedChart" height="180"></canvas>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">üìã Trip Events</div></div>
          <div id="tripEventsFeed"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: ALERTS ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-alerts">
    <div class="card">
      <div class="card-header">
        <div class="card-title">üîî All Alerts ‚Äî Today</div>
        <div class="detail-chips">
          <span class="tag red">1 Critical</span>
          <span class="tag amber">2 Warning</span>
          <span class="tag teal">3 Info</span>
        </div>
      </div>
      <div id="allAlertsFeed"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: TRIPS ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-trips">
    <div class="card" style="margin-bottom:20px;">
      <div class="card-header">
        <div class="card-title">üó∫Ô∏è Trip History</div>
        <div class="card-action" onclick="showToast('üìä Trips exported to CSV.','success')">Export CSV</div>
      </div>
      <div id="tripHistoryList"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: REPORTS ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-reports">
    <div class="report-grid">
      <div class="report-card">
        <div class="report-unit">Total Trips</div>
        <div class="report-num" style="color:var(--teal)">47</div>
        <div class="report-label">This Month</div>
        <div class="report-trend up">‚Üë 12% vs last month</div>
      </div>
      <div class="report-card">
        <div class="report-unit">km Driven</div>
        <div class="report-num" style="color:var(--navy)">318</div>
        <div class="report-label">Total Distance</div>
        <div class="report-trend up">‚Üë 8% vs last month</div>
      </div>
      <div class="report-card">
        <div class="report-unit">Safety Score</div>
        <div class="report-num" style="color:var(--green)">82%</div>
        <div class="report-label">Average Score</div>
        <div class="report-trend up">‚Üë 4% improvement</div>
      </div>
      <div class="report-card">
        <div class="report-unit">Speeding Events</div>
        <div class="report-num" style="color:var(--amber)">6</div>
        <div class="report-label">This Month</div>
        <div class="report-trend down">‚Üì 3 less than last month</div>
      </div>
      <div class="report-card">
        <div class="report-unit">Harsh Braking</div>
        <div class="report-num" style="color:var(--red)">9</div>
        <div class="report-label">Events Total</div>
        <div class="report-trend up">‚Üì 5 less than last month</div>
      </div>
      <div class="report-card">
        <div class="report-unit">Emergency Alerts</div>
        <div class="report-num" style="color:var(--navy)">0</div>
        <div class="report-label">This Month</div>
        <div class="report-trend up">‚úÖ No emergencies</div>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <div class="card-title">üìà Weekly Safety Score Trend</div>
        <div class="card-action" onclick="showToast('üìÑ Report exported.','success')">Export PDF</div>
      </div>
      <div class="chart-wrap" style="padding:20px;">
        <canvas id="reportChart" height="120"></canvas>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: DRIVERS ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-drivers">
    <div class="grid-2">
      <div id="driverProfilesContainer"></div>
      <div>
        <div class="card">
          <div class="card-header"><div class="card-title">üìä All Drivers Overview</div></div>
          <div style="overflow-x:auto;">
            <table class="driver-table">
              <thead>
                <tr>
                  <th>Driver</th><th>License</th><th>Status</th><th>Score</th><th>Trips</th>
                </tr>
              </thead>
              <tbody id="allDriversTbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: REGISTER ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-register">
    <div class="grid-2">
      <div class="card">
        <div class="card-header"><div class="card-title">‚ûï Register New Driver</div></div>
        <div class="card-body">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">First Name</label>
              <input class="form-input" id="reg-fname" placeholder="e.g. Juan">
            </div>
            <div class="form-group">
              <label class="form-label">Last Name</label>
              <input class="form-input" id="reg-lname" placeholder="e.g. Dela Cruz">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Email Address</label>
            <input class="form-input" id="reg-email" type="email" placeholder="driver@email.com">
          </div>
          <div class="form-group">
            <label class="form-label">Mobile Number</label>
            <input class="form-input" id="reg-phone" placeholder="09XX-XXX-XXXX">
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Age</label>
              <input class="form-input" id="reg-age" type="number" min="16" max="25" placeholder="16‚Äì25">
            </div>
            <div class="form-group">
              <label class="form-label">License Type</label>
              <select class="form-select" id="reg-license">
                <option>Student Permit</option>
                <option>Learner's Permit</option>
                <option>Non-Professional</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Address in Calinog, Iloilo</label>
            <input class="form-input" id="reg-address" placeholder="Barangay, Calinog, Iloilo">
          </div>
          <div class="form-group">
            <label class="form-label">Linked Parent Account</label>
            <select class="form-select" id="reg-parent">
              <option>Jane Doe (jane@email.com)</option>
              <option>+ Add new parent</option>
            </select>
          </div>
          <button class="btn-primary" onclick="registerDriver()">‚úÖ Register Driver</button>
        </div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">üìã Registration Guidelines</div></div>
        <div class="card-body">
          <div class="alert-item" style="border-radius:var(--radius-sm);border:1px solid var(--teal-light);background:var(--teal-light);margin-bottom:12px;">
            <div class="alert-content">
              <div class="alert-title" style="color:var(--teal)">Who can be registered?</div>
              <div class="alert-desc">Student drivers aged 16‚Äì25 residing in Calinog, Iloilo with a valid student or learner's permit issued by the LTO.</div>
            </div>
          </div>
          <div style="font-size:13px;color:var(--text2);line-height:1.7;">
            <p style="margin-bottom:10px;"><strong>Requirements:</strong></p>
            <p>‚Ä¢ Valid LTO Student or Learner's Permit</p>
            <p>‚Ä¢ Parent/Guardian with registered account</p>
            <p>‚Ä¢ Smartphone with GPS capability</p>
            <p>‚Ä¢ Consent form signed by parent/guardian</p>
            <p style="margin-top:12px;"><strong>After registration:</strong></p>
            <p>‚Ä¢ Driver receives login credentials via email</p>
            <p>‚Ä¢ Parent receives confirmation and monitoring link</p>
            <p>‚Ä¢ Default speed alert: 60 km/h</p>
            <p>‚Ä¢ GPS tracking begins on first trip start</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: OOP ARCHITECTURE ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-oop">
    <div class="grid-2">
      <div class="card">
        <div class="card-header"><div class="card-title">üèóÔ∏è OOP Class Architecture</div></div>
        <div class="oop-diagram">
          <!-- MonitoringSystem (Singleton) -->
          <div class="oop-class">
            <div class="oop-class-header singleton">üî¥ MonitoringSystem &lt;&lt;Singleton&gt;&gt;</div>
            <div class="oop-class-body">
              <div class="oop-attr">- _instance: MonitoringSystem = None</div>
              <div class="oop-attr">- drivers: Dict[str, StudentDriver]</div>
              <div class="oop-attr">- parents: Dict[str, Parent]</div>
              <div class="oop-attr">- alert_log: List[Alert]</div>
              <div class="oop-method">+ get_instance() ‚Üí MonitoringSystem</div>
              <div class="oop-method">+ register_driver(driver: StudentDriver)</div>
              <div class="oop-method">+ register_parent(parent: Parent)</div>
              <div class="oop-method">+ get_all_alerts() ‚Üí List[Alert]</div>
              <div class="oop-method">+ generate_report(driver_id) ‚Üí Report</div>
            </div>
          </div>
          <div class="oop-arrow">‚Üï manages</div>
          <!-- User (Abstract) -->
          <div class="oop-class">
            <div class="oop-class-header abstract">üîµ User &lt;&lt;Abstract&gt;&gt;</div>
            <div class="oop-class-body">
              <div class="oop-attr">- user_id: str</div>
              <div class="oop-attr">- name: str</div>
              <div class="oop-attr">- email: str</div>
              <div class="oop-attr">- phone: str</div>
              <div class="oop-method">+ get_role() ‚Üí str  &lt;&lt;abstract&gt;&gt;</div>
              <div class="oop-method">+ get_info() ‚Üí dict</div>
            </div>
          </div>
          <div class="oop-arrow">‚Üï inherits</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
            <!-- StudentDriver -->
            <div class="oop-class">
              <div class="oop-class-header concrete">üü¢ StudentDriver (User, Subject)</div>
              <div class="oop-class-body">
                <div class="oop-attr">- location: Location</div>
                <div class="oop-attr">- speed: float</div>
                <div class="oop-attr">- trip: Trip</div>
                <div class="oop-attr">- observers: List[Parent]</div>
                <div class="oop-method">+ update_location(loc, speed)</div>
                <div class="oop-method">+ start_trip(location)</div>
                <div class="oop-method">+ end_trip(location)</div>
                <div class="oop-method">+ trigger_emergency(loc, msg)</div>
                <div class="oop-method">+ notify_observers()</div>
                <div class="oop-method">+ get_role() ‚Üí "driver"</div>
              </div>
            </div>
            <!-- Parent -->
            <div class="oop-class">
              <div class="oop-class-header concrete">üü¢ Parent (User, Observer)</div>
              <div class="oop-class-body">
                <div class="oop-attr">- drivers: List[StudentDriver]</div>
                <div class="oop-attr">- prefs: NotificationPrefs</div>
                <div class="oop-attr">- alert_history: List[Alert]</div>
                <div class="oop-method">+ update(event: Event)</div>
                <div class="oop-method">+ add_driver(driver)</div>
                <div class="oop-method">+ get_driver_status(id)</div>
                <div class="oop-method">+ set_notification_pref(k,v)</div>
                <div class="oop-method">+ get_role() ‚Üí "parent"</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="card" style="margin-bottom:16px;">
          <div class="card-header"><div class="card-title">üîÑ Observer Pattern Flow</div></div>
          <div class="card-body" style="font-size:13px;color:var(--text2);line-height:1.9;">
            <div style="background:var(--teal-light);border-radius:var(--radius-sm);padding:14px;margin-bottom:12px;font-family:'DM Mono',monospace;font-size:12px;line-height:2;">
              <div style="color:var(--text3)"># Real-time update flow</div>
              <div><span style="color:var(--teal)">driver</span>.update_location(new_loc, 65.0)</div>
              <div>&nbsp;&nbsp;‚Üí <span style="color:var(--amber)">speed_check()</span>: 65 > 60 ‚Üí Alert!</div>
              <div>&nbsp;&nbsp;‚Üí <span style="color:var(--teal)">notify_observers()</span></div>
              <div>&nbsp;&nbsp;&nbsp;&nbsp;‚Üí <span style="color:var(--green)">parent.update(SpeedAlert)</span></div>
              <div>&nbsp;&nbsp;&nbsp;&nbsp;‚Üí Push notification sent üì±</div>
            </div>
            <p><strong>1. StudentDriver</strong> acts as the Subject ‚Äî it holds the state (location, speed) and notifies all attached observers on every update.</p>
            <p style="margin-top:8px;"><strong>2. Parent</strong> implements Observer ‚Äî the update() method is called automatically whenever the driver triggers an event.</p>
            <p style="margin-top:8px;"><strong>3. MonitoringSystem</strong> (Singleton) ensures only one central controller manages all drivers and parents, preventing duplicate state.</p>
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">üì¶ Design Patterns Applied</div></div>
          <div class="card-body">
            <div style="display:flex;flex-direction:column;gap:12px;">
              <div style="display:flex;gap:12px;align-items:flex-start;">
                <div style="background:var(--red-light);color:var(--red);font-size:18px;padding:8px;border-radius:8px;">üî¥</div>
                <div><div style="font-weight:700;font-size:13px;">Singleton Pattern</div><div style="font-size:12px;color:var(--text3);margin-top:2px;">MonitoringSystem ‚Äî one instance manages all drivers and parents system-wide</div></div>
              </div>
              <div style="display:flex;gap:12px;align-items:flex-start;">
                <div style="background:var(--teal-light);color:var(--teal);font-size:18px;padding:8px;border-radius:8px;">üîµ</div>
                <div><div style="font-weight:700;font-size:13px;">Observer Pattern</div><div style="font-size:12px;color:var(--text3);margin-top:2px;">StudentDriver (Subject) ‚Üí Parent (Observer) ‚Äî real-time event push</div></div>
              </div>
              <div style="display:flex;gap:12px;align-items:flex-start;">
                <div style="background:var(--amber-light);color:var(--amber);font-size:18px;padding:8px;border-radius:8px;">üì¶</div>
                <div><div style="font-weight:700;font-size:13px;">Abstraction & Encapsulation</div><div style="font-size:12px;color:var(--text3);margin-top:2px;">Abstract User class; private attributes with property decorators in all subclasses</div></div>
              </div>
              <div style="display:flex;gap:12px;align-items:flex-start;">
                <div style="background:var(--green-light);color:var(--green);font-size:18px;padding:8px;border-radius:8px;">üîÄ</div>
                <div><div style="font-weight:700;font-size:13px;">Inheritance & Polymorphism</div><div style="font-size:12px;color:var(--text3);margin-top:2px;">StudentDriver and Parent both extend User; get_role() overridden in each subclass</div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PAGE: SETTINGS ‚îÄ‚îÄ‚îÄ -->
  <div class="content hidden" id="page-settings">
    <div class="grid-2">
      <div>
        <div class="card" style="margin-bottom:20px;">
          <div class="card-header"><div class="card-title">üîî Alert Thresholds</div></div>
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Speed Limit Alert</div>
              <div class="setting-desc">Notify when driver exceeds this speed (km/h)</div>
            </div>
            <input class="setting-input" type="number" value="60" id="set-speed">
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Harsh Braking Threshold</div>
              <div class="setting-desc">G-force threshold for harsh braking alert</div>
            </div>
            <input class="setting-input" type="number" value="-0.4" id="set-brake" step="0.1">
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">Harsh Acceleration Threshold</div>
              <div class="setting-desc">G-force threshold for harsh acceleration alert</div>
            </div>
            <input class="setting-input" type="number" value="0.4" id="set-accel" step="0.1">
          </div>
          <div class="setting-row">
            <div class="setting-info">
              <div class="setting-label">GPS Refresh Rate</div>
              <div class="setting-desc">Location update interval (seconds)</div>
            </div>
            <input class="setting-input" type="number" value="10" id="set-gps">
          </div>
        </div>
        <div class="card">
          <div class="card-header"><div class="card-title">üì± Notification Preferences</div></div>
          <div class="setting-row">
            <div class="setting-info"><div class="setting-label">Push Notifications</div><div class="setting-desc">In-app alerts for all events</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="setting-row">
            <div class="setting-info"><div class="setting-label">SMS Alerts</div><div class="setting-desc">Text messages for critical events</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="setting-row">
            <div class="setting-info"><div class="setting-label">Email Reports</div><div class="setting-desc">Weekly summary reports via email</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="setting-row">
            <div class="setting-info"><div class="setting-label">Emergency Calls</div><div class="setting-desc">Auto-dial parent on emergency trigger</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="setting-row">
            <div class="setting-info"><div class="setting-label">Speeding Alerts</div><div class="setting-desc">Alert when driver exceeds speed limit</div></div>
            <div class="toggle on" onclick="this.classList.toggle('on')"></div>
          </div>
          <div class="setting-row">
            <div class="setting-info"><div class="setting-label">Trip Start/End Alerts</div><div class="setting-desc">Notify when driver starts or ends a trip</div></div>
            <div class="toggle" onclick="this.classList.toggle('on')"></div>
          </div>
          <div style="padding:16px;">
            <button class="btn-primary" onclick="saveSettings()">üíæ Save Settings</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header"><div class="card-title">üë§ Account Settings</div></div>
        <div class="card-body">
          <div class="form-group"><label class="form-label">Full Name</label><input class="form-input" value="Jane Doe" id="set-name"></div>
          <div class="form-group"><label class="form-label">Email</label><input class="form-input" value="jane@email.com" type="email" id="set-email"></div>
          <div class="form-group"><label class="form-label">Phone</label><input class="form-input" value="0917-555-0001" id="set-phone"></div>
          <div class="form-group"><label class="form-label">Address</label><input class="form-input" value="Calinog, Iloilo" id="set-addr"></div>
          <div class="form-group"><label class="form-label">Relationship to Driver</label>
            <select class="form-select"><option>Mother</option><option>Father</option><option>Guardian</option></select>
          </div>
          <button class="btn-primary" onclick="showToast('‚úÖ Account updated successfully.','success')">Update Account</button>
        </div>
        <div style="border-top:1px solid var(--border);padding:20px;">
          <div style="font-size:13px;font-weight:700;color:var(--text2);margin-bottom:12px;text-transform:uppercase;letter-spacing:.8px;">System Info</div>
          <div style="font-size:12.5px;color:var(--text3);line-height:2.2;">
            <div>Version: <strong style="color:var(--text)">SDMS v1.0.0</strong></div>
            <div>Location: <strong style="color:var(--text)">Calinog, Iloilo, Philippines</strong></div>
            <div>Project: <strong style="color:var(--text)">MITS 709 Capstone</strong></div>
            <div>Institution: <strong style="color:var(--text)">ISUFST</strong></div>
            <div>Developer: <strong style="color:var(--text)">Cabayao, Minard L.</strong></div>
            <div>GPS Provider: <strong style="color:var(--text)">W3C Geolocation API</strong></div>
            <div>Backend: <strong style="color:var(--text)">Python / Django REST</strong></div>
          </div>
        </div>
      </div>
    </div>
  </div>

</main><!-- /main -->

<!-- ‚îÄ‚îÄ‚îÄ NOTIFICATION PANEL ‚îÄ‚îÄ‚îÄ -->
<div class="notif-panel" id="notifPanel">
  <div class="notif-header">
    Notifications <span class="notif-clear" onclick="clearNotifs()">Clear all</span>
  </div>
  <div id="notifList"></div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ EMERGENCY MODAL ‚îÄ‚îÄ‚îÄ -->
<div class="modal-overlay" id="emergencyModal">
  <div class="modal">
    <div class="modal-icon">üÜò</div>
    <div class="modal-title">Emergency Alert</div>
    <div class="modal-desc">This will immediately notify all registered parents/guardians with the driver's live GPS location.</div>
    <div class="modal-detail">
      <div class="modal-detail-row"><span class="modal-detail-key">Driver</span><span class="modal-detail-val">John Doe Jr.</span></div>
      <div class="modal-detail-row"><span class="modal-detail-key">Location</span><span class="modal-detail-val">Calinog Poblacion, Iloilo</span></div>
      <div class="modal-detail-row"><span class="modal-detail-key">Speed</span><span class="modal-detail-val">45 km/h</span></div>
      <div class="modal-detail-row"><span class="modal-detail-key">Time</span><span class="modal-detail-val" id="emergencyTime"></span></div>
    </div>
    <div class="modal-actions">
      <button class="modal-btn primary" onclick="triggerEmergency()">üÜò Send Alert Now</button>
      <button class="modal-btn secondary" onclick="closeEmergency()">Cancel</button>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ TOAST CONTAINER ‚îÄ‚îÄ‚îÄ -->
<div class="toast-container" id="toastContainer"></div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

const drivers = [
  { id: 'D001', name: 'John Doe Jr.', initials: 'JJ', age: 17, license: "Learner's Permit", status: 'driving', speed: 45, score: 82, scoreGrade: 'B', trips: 23, distance: 167.4, address: 'Brgy. Cagay, Calinog, Iloilo', parentId: 'P001' },
  { id: 'D002', name: 'Maria Santos', initials: 'MS', age: 19, license: 'Student Permit', status: 'driving', speed: 58, score: 74, scoreGrade: 'C', trips: 24, distance: 150.6, address: 'Brgy. Garangan, Calinog, Iloilo', parentId: 'P001' }
];

const alertsData = [
  { id:1, type:'red', icon:'‚ö°', title:'Speeding Alert ‚Äî John Jr.', desc:'Speed reached 68 km/h near Calinog High School. Limit: 60 km/h.', time:'2:38 PM', level:'Critical' },
  { id:2, type:'amber', icon:'üõë', title:'Harsh Braking ‚Äî Maria', desc:'Sudden deceleration detected near Calinog Public Market. G-force: -0.6.', time:'2:25 PM', level:'Warning' },
  { id:3, type:'amber', icon:'üõë', title:'Harsh Braking ‚Äî John Jr.', desc:'Sudden deceleration at Brgy. Dalicanan junction.', time:'1:52 PM', level:'Warning' },
  { id:4, type:'teal', icon:'üöó', title:'Trip Started ‚Äî Maria', desc:'Trip began at 1:30 PM from Brgy. Garangan, Calinog.', time:'1:30 PM', level:'Info' },
  { id:5, type:'teal', icon:'üöó', title:'Trip Started ‚Äî John Jr.', desc:'Trip began at 2:14 PM from Calinog Poblacion.', time:'2:14 PM', level:'Info' },
  { id:6, type:'green', icon:'‚úÖ', title:'Safe Trip Completed ‚Äî Maria', desc:'Previous trip completed. Safety score: 78/100. Distance: 8.2 km.', time:'12:45 PM', level:'Info' }
];

const tripsData = [
  { driver:'John Jr.', from:'Calinog Poblacion', to:'Brgy. Cagay', date:'Today, 2:14 PM', dist:'7.2 km', dur:'18 min', score:'good', scoreVal:'82', events:['1 speed alert'] },
  { driver:'Maria', from:'Brgy. Garangan', to:'Calinog Market', date:'Today, 1:30 PM', dist:'5.4 km', dur:'14 min', score:'ok', scoreVal:'74', events:['1 harsh braking'] },
  { driver:'John Jr.', from:'Calinog Central', to:'Brgy. Dalicanan', date:'Yesterday, 4:00 PM', dist:'9.1 km', dur:'24 min', score:'good', scoreVal:'88', events:['Clean trip'] },
  { driver:'Maria', from:'Calinog Market', to:'Brgy. Agcalaga', date:'Yesterday, 2:15 PM', dist:'6.8 km', dur:'20 min', score:'good', scoreVal:'85', events:['Clean trip'] },
  { driver:'John Jr.', from:'Brgy. Balabag', to:'Calinog Poblacion', date:'Feb 17, 3:00 PM', dist:'4.3 km', dur:'11 min', score:'bad', scoreVal:'61', events:['2 speeding','1 harsh accel'] },
  { driver:'Maria', from:'Calinog High School', to:'Brgy. Cagay', date:'Feb 17, 1:00 PM', dist:'11.2 km', dur:'30 min', score:'good', scoreVal:'90', events:['Clean trip'] }
];

const tripEvents = [
  { icon:'üöó', color:'teal', text:'Trip started at Calinog Poblacion', time:'2:14 PM' },
  { icon:'‚ö°', color:'red', text:'Speed 68 km/h ‚Äî over limit!', time:'2:38 PM' },
  { icon:'üõë', color:'amber', text:'Harsh braking at Brgy. Dalicanan', time:'2:52 PM' },
  { icon:'üìç', color:'teal', text:'Currently: Calinog Central', time:'3:02 PM' }
];

let currentRole = 'parent';
let notifOpen = false;
const speedHistory = [35,40,42,55,68,60,52,45,48,43,45,42,44,45];
const labels = ['2:14','2:17','2:20','2:23','2:26','2:29','2:32','2:35','2:38','2:41','2:44','2:47','2:50','3:02'];

// ‚îÄ‚îÄ‚îÄ PAGE NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const pages = { dashboard:'Dashboard', livetrack:'Live Tracking', alerts:'Alerts', trips:'Trip History', reports:'Reports', drivers:'Driver Management', register:'Register Driver', oop:'OOP Architecture', settings:'Settings' };
const subs = { dashboard:'Overview ¬∑ Calinog, Iloilo', livetrack:'Real-Time GPS ¬∑ 2 Active', alerts:'3 alerts today', trips:'Full history log', reports:'Monthly analytics', drivers:'Manage monitored drivers', register:'Add new student driver', oop:'System design patterns', settings:'Configure system' };

function showPage(id) {
  document.querySelectorAll('.content').forEach(c => c.classList.add('hidden'));
  document.getElementById('page-' + id).classList.remove('hidden');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => { if(n.textContent.trim().toLowerCase().includes(pages[id]?.toLowerCase().substring(0,5))) n.classList.add('active'); });
  document.getElementById('pageTitle').textContent = pages[id] || id;
  document.getElementById('pageSub').textContent = subs[id] || '';
  if(id === 'livetrack') initSpeedChart();
  if(id === 'reports') initReportChart();
}

// ‚îÄ‚îÄ‚îÄ ROLE SWITCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchRole(role) {
  currentRole = role;
  document.getElementById('btnParent').classList.toggle('active', role === 'parent');
  document.getElementById('btnDriver').classList.toggle('active', role === 'driver');
  const isDriver = role === 'driver';
  document.getElementById('userAvatarSidebar').textContent = isDriver ? 'JJ' : 'JD';
  document.getElementById('userNameSidebar').textContent = isDriver ? 'John Doe Jr.' : 'Jane Doe';
  document.getElementById('userRoleSidebar').textContent = isDriver ? 'Student Driver' : 'Parent / Guardian';
  showToast(isDriver ? 'üöó Switched to Driver view.' : 'üë®‚Äçüë©‚Äçüë¶ Switched to Parent view.', 'success');
}

// ‚îÄ‚îÄ‚îÄ RENDER FUNCTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderAlerts(containerId, alerts) {
  const el = document.getElementById(containerId);
  if(!el) return;
  el.innerHTML = alerts.map(a => `
    <div class="alert-item">
      <div class="alert-icon-wrap ${a.type}"><span>${a.icon}</span></div>
      <div class="alert-content">
        <div class="alert-title">${a.title}</div>
        <div class="alert-desc">${a.desc}</div>
      </div>
      <div style="text-align:right;">
        <div class="alert-time">${a.time}</div>
        <div class="tag ${a.level==='Critical'?'red':a.level==='Warning'?'amber':'teal'}" style="margin-top:4px;">${a.level}</div>
      </div>
    </div>`).join('');
}

function renderDriversTable(tbodyId) {
  const el = document.getElementById(tbodyId);
  if(!el) return;
  el.innerHTML = drivers.map(d => `
    <tr>
      <td>
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="user-avatar" style="width:32px;height:32px;font-size:12px;">${d.initials}</div>
          <div><div style="font-weight:600;">${d.name}</div><div style="font-size:11px;color:var(--text3);">${d.id}</div></div>
        </div>
      </td>
      <td>
        <span class="status-pill ${d.status}">${d.status === 'driving' ? 'Driving' : d.status}</span>
      </td>
      <td>
        <div style="font-weight:700;color:${d.speed>60?'var(--red)':d.speed>50?'var(--amber)':'var(--green)'};">${d.speed} km/h</div>
        <div class="speed-bar-wrap"><div class="speed-bar-bg"><div class="speed-bar ${d.speed>60?'danger':d.speed>50?'warning':'safe'}" style="width:${Math.min(d.speed/100*100,100)}%"></div></div></div>
      </td>
      <td><div class="score-badge ${d.scoreGrade}">${d.scoreGrade}</div></td>
    </tr>`).join('');
}

function renderAllDriversTable() {
  const el = document.getElementById('allDriversTbody');
  if(!el) return;
  el.innerHTML = drivers.map(d => `
    <tr>
      <td>
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="user-avatar" style="width:32px;height:32px;font-size:12px;">${d.initials}</div>
          <div><div style="font-weight:600;">${d.name}</div><div style="font-size:11px;color:var(--text3);">${d.address}</div></div>
        </div>
      </td>
      <td><span class="tag teal">${d.license}</span></td>
      <td><span class="status-pill ${d.status}">${d.status}</span></td>
      <td><div class="score-badge ${d.scoreGrade}">${d.scoreGrade}</div> <span style="font-size:12px;color:var(--text3);">${d.score}/100</span></td>
      <td style="font-weight:700;">${d.trips}</td>
    </tr>`).join('');
}

function renderDriverProfiles() {
  const el = document.getElementById('driverProfilesContainer');
  if(!el) return;
  el.innerHTML = drivers.map(d => `
    <div class="card" style="margin-bottom:16px;">
      <div class="profile-header">
        <div class="profile-avatar">${d.initials}</div>
        <div>
          <div class="profile-name">${d.name}</div>
          <div class="profile-meta">${d.address}</div>
          <div class="profile-meta">Age ${d.age} ¬∑ ${d.id}</div>
          <span class="profile-tag">${d.license}</span>
        </div>
      </div>
      <div class="profile-stats">
        <div class="profile-stat"><div class="profile-stat-val">${d.trips}</div><div class="profile-stat-label">Total Trips</div></div>
        <div class="profile-stat"><div class="profile-stat-val" style="color:${d.score>=80?'var(--green)':'var(--amber)'};">${d.score}%</div><div class="profile-stat-label">Safety Score</div></div>
        <div class="profile-stat"><div class="profile-stat-val">${d.distance} km</div><div class="profile-stat-label">Distance</div></div>
      </div>
      <div class="card-body" style="padding:12px 16px;">
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <span class="tag ${d.status==='driving'?'green':'teal'}">${d.status}</span>
          <span class="tag amber">Score: ${d.score}/100</span>
          <span class="tag blue">${d.speed} km/h live</span>
        </div>
      </div>
    </div>`).join('');
}

function renderTrips() {
  const el = document.getElementById('tripHistoryList');
  if(!el) return;
  el.innerHTML = tripsData.map(t => `
    <div class="trip-item">
      <div class="trip-icon">üó∫Ô∏è</div>
      <div class="trip-info">
        <div class="trip-name">${t.from} ‚Üí ${t.to}</div>
        <div class="trip-meta">${t.driver} ¬∑ ${t.date} ¬∑ ${t.events.join(', ')}</div>
      </div>
      <div class="trip-stats">
        <div class="trip-dist">${t.dist}</div>
        <div class="trip-dur">${t.dur}</div>
        <div class="trip-score ${t.score}" style="margin-top:4px;">${t.scoreVal}/100</div>
      </div>
    </div>`).join('');
}

function renderTripEvents() {
  const el = document.getElementById('tripEventsFeed');
  if(!el) return;
  el.innerHTML = tripEvents.map(e => `
    <div class="alert-item">
      <div class="alert-icon-wrap ${e.color}">${e.icon}</div>
      <div class="alert-content"><div class="alert-title">${e.text}</div></div>
      <div class="alert-time">${e.time}</div>
    </div>`).join('');
}

function renderNotifPanel() {
  const el = document.getElementById('notifList');
  if(!el) return;
  el.innerHTML = alertsData.slice(0,4).map(a => `
    <div class="alert-item">
      <div class="alert-icon-wrap ${a.type}">${a.icon}</div>
      <div class="alert-content"><div class="alert-title" style="font-size:12.5px;">${a.title}</div><div class="alert-desc">${a.time}</div></div>
    </div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let speedChartInst = null;
let reportChartInst = null;

function initSpeedChart() {
  const ctx = document.getElementById('speedChart');
  if(!ctx) return;
  if(speedChartInst) speedChartInst.destroy();

  // Manual canvas draw ‚Äî no external lib needed
  const canvas = ctx;
  canvas.width = canvas.offsetWidth || 400;
  canvas.height = 180;
  const c = canvas.getContext('2d');
  const w = canvas.width, h = canvas.height;
  const pad = { top:20, right:16, bottom:36, left:40 };
  const cw = w - pad.left - pad.right, ch = h - pad.top - pad.bottom;
  const max = 80, min = 0;
  const pts = speedHistory;

  c.clearRect(0,0,w,h);

  // Grid lines
  c.strokeStyle = '#E8EDF3'; c.lineWidth = 1;
  [0,20,40,60,80].forEach(v => {
    const y = pad.top + ch - (v/max)*ch;
    c.beginPath(); c.moveTo(pad.left, y); c.lineTo(pad.left+cw, y); c.stroke();
    c.fillStyle = '#8A96A8'; c.font = '10px DM Sans,sans-serif'; c.textAlign = 'right';
    c.fillText(v, pad.left-6, y+3);
  });

  // Danger zone (>60)
  const dangerY = pad.top + ch - (60/max)*ch;
  c.fillStyle = 'rgba(192,57,43,0.06)';
  c.fillRect(pad.left, pad.top, cw, dangerY - pad.top);

  // Limit line
  c.setLineDash([4,4]); c.strokeStyle = 'rgba(192,57,43,0.5)'; c.lineWidth = 1.5;
  c.beginPath(); c.moveTo(pad.left, dangerY); c.lineTo(pad.left+cw, dangerY); c.stroke();
  c.setLineDash([]);
  c.fillStyle = 'rgba(192,57,43,0.7)'; c.font = '10px DM Sans,sans-serif'; c.textAlign = 'left';
  c.fillText('60 km/h limit', pad.left+4, dangerY-4);

  // Gradient fill
  const grad = c.createLinearGradient(0, pad.top, 0, pad.top+ch);
  grad.addColorStop(0, 'rgba(2,128,144,0.25)');
  grad.addColorStop(1, 'rgba(2,128,144,0)');

  const xStep = cw / (pts.length - 1);
  const getXY = (i,v) => ({ x: pad.left + i*xStep, y: pad.top + ch - (v/max)*ch });

  // Fill area
  c.beginPath();
  c.moveTo(getXY(0,pts[0]).x, pad.top+ch);
  pts.forEach((v,i) => { const p = getXY(i,v); c.lineTo(p.x, p.y); });
  c.lineTo(getXY(pts.length-1,pts[pts.length-1]).x, pad.top+ch);
  c.closePath(); c.fillStyle = grad; c.fill();

  // Line
  c.beginPath();
  pts.forEach((v,i) => {
    const p = getXY(i,v);
    i===0 ? c.moveTo(p.x,p.y) : c.lineTo(p.x,p.y);
  });
  c.strokeStyle = '#028090'; c.lineWidth = 2.5; c.lineJoin = 'round'; c.stroke();

  // Points + color coding
  pts.forEach((v,i) => {
    const p = getXY(i,v);
    c.beginPath(); c.arc(p.x,p.y,4,0,Math.PI*2);
    c.fillStyle = v>60 ? '#C0392B' : v>50 ? '#E8A020' : '#1A7F5A';
    c.fill(); c.strokeStyle='white'; c.lineWidth=1.5; c.stroke();
  });

  // X labels
  const step = Math.ceil(pts.length / 5);
  pts.forEach((v,i) => {
    if(i % step === 0) {
      const p = getXY(i,v);
      c.fillStyle = '#8A96A8'; c.font = '9px DM Mono,monospace'; c.textAlign = 'center';
      c.fillText(labels[i], p.x, pad.top+ch+14);
    }
  });
}

function initReportChart() {
  const ctx = document.getElementById('reportChart');
  if(!ctx) return;
  ctx.width = ctx.offsetWidth || 600;
  ctx.height = 120;
  const c = ctx.getContext('2d');
  const w = ctx.width, h = ctx.height;
  const pad = { top:10, right:20, bottom:30, left:40 };
  const cw = w - pad.left - pad.right, ch = h - pad.top - pad.bottom;
  const weeks = ['Week 1','Week 2','Week 3','Week 4','This Week'];
  const scores = [70, 74, 78, 79, 82];
  const max = 100;

  c.clearRect(0,0,w,h);
  const xStep = cw / (scores.length - 1);
  const getXY = (i,v) => ({ x: pad.left + i*xStep, y: pad.top + ch - (v/max)*ch });

  // Gradient fill
  const grad = c.createLinearGradient(0, pad.top, 0, pad.top+ch);
  grad.addColorStop(0,'rgba(26,127,90,0.2)'); grad.addColorStop(1,'rgba(26,127,90,0)');
  c.beginPath(); c.moveTo(getXY(0,scores[0]).x, pad.top+ch);
  scores.forEach((v,i) => { const p=getXY(i,v); c.lineTo(p.x,p.y); });
  c.lineTo(getXY(scores.length-1,scores[scores.length-1]).x, pad.top+ch);
  c.closePath(); c.fillStyle = grad; c.fill();

  c.beginPath();
  scores.forEach((v,i) => { const p=getXY(i,v); i===0?c.moveTo(p.x,p.y):c.lineTo(p.x,p.y); });
  c.strokeStyle='#1A7F5A'; c.lineWidth=2.5; c.lineJoin='round'; c.stroke();

  scores.forEach((v,i) => {
    const p=getXY(i,v);
    c.beginPath(); c.arc(p.x,p.y,5,0,Math.PI*2);
    c.fillStyle='#1A7F5A'; c.fill(); c.strokeStyle='white'; c.lineWidth=2; c.stroke();
    c.fillStyle='#0A2240'; c.font='bold 11px DM Sans,sans-serif'; c.textAlign='center';
    c.fillText(v+'%', p.x, p.y-10);
    c.fillStyle='#8A96A8'; c.font='10px DM Sans,sans-serif';
    c.fillText(weeks[i], p.x, pad.top+ch+18);
  });
}

// ‚îÄ‚îÄ‚îÄ UI INTERACTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleNotif() {
  notifOpen = !notifOpen;
  document.getElementById('notifPanel').classList.toggle('open', notifOpen);
}

function clearNotifs() {
  document.getElementById('notifList').innerHTML = '<div style="padding:20px;text-align:center;color:var(--text3);font-size:13px;">No new notifications</div>';
  document.getElementById('notifDot').style.display='none';
  document.getElementById('alertBadge').style.display='none';
  showToast('‚úÖ All notifications cleared.','success');
  notifOpen = false;
  document.getElementById('notifPanel').classList.remove('open');
}

function openEmergency() {
  document.getElementById('emergencyTime').textContent = new Date().toLocaleTimeString('en-PH',{hour:'2-digit',minute:'2-digit'});
  document.getElementById('emergencyModal').classList.add('open');
}
function closeEmergency() { document.getElementById('emergencyModal').classList.remove('open'); }
function triggerEmergency() {
  closeEmergency();
  showToast('üÜò EMERGENCY ALERT SENT! Parents notified with GPS location.','error');
  showToast('üì± SMS sent to Jane Doe (0917-555-0001).','success');
}

function registerDriver() {
  const fname = document.getElementById('reg-fname').value.trim();
  const lname = document.getElementById('reg-lname').value.trim();
  if(!fname || !lname) { showToast('‚ö†Ô∏è Please enter driver name.','warning'); return; }
  showToast(`‚úÖ Driver ${fname} ${lname} registered successfully!`,'success');
  showToast('üìß Login credentials sent to driver email.','success');
  document.querySelectorAll('#page-register .form-input').forEach(i => i.value = '');
}

function saveSettings() {
  showToast('üíæ Settings saved successfully.','success');
}

function showToast(msg, type='') {
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${msg}</span>`;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => el.remove(), 4000);
}

// ‚îÄ‚îÄ‚îÄ LIVE DATA SIMULATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function simulateLiveData() {
  const d1 = drivers[0];
  const d2 = drivers[1];
  // Vary speed slightly
  d1.speed = Math.max(30, Math.min(70, d1.speed + (Math.random()-0.5)*6));
  d2.speed = Math.max(40, Math.min(65, d2.speed + (Math.random()-0.5)*5));
  d1.speed = Math.round(d1.speed);
  d2.speed = Math.round(d2.speed);

  // Update stat
  const avgSpeed = Math.round((d1.speed + d2.speed) / 2);
  document.getElementById('stat-speed').innerHTML = `${avgSpeed} <span style="font-size:16px;font-weight:400">km/h</span>`;

  // Update duration
  const dur = document.getElementById('lt-duration');
  if(dur) {
    const mins = parseInt(dur.textContent) + 1;
    dur.innerHTML = `${mins} <small>min</small>`;
  }

  // Update gauge
  const gv = document.getElementById('gaugeVal');
  if(gv) gv.textContent = d1.speed;

  // Speed alert
  if(d1.speed > 60) showToast(`‚ö° John Jr. speed: ${d1.speed} km/h ‚Äî Over limit!`,'error');
  if(d2.speed > 60) showToast(`‚ö° Maria speed: ${d2.speed} km/h ‚Äî Over limit!`,'error');
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded', () => {
  renderAlerts('dashAlerts', alertsData.slice(0,4));
  renderAlerts('allAlertsFeed', alertsData);
  renderDriversTable('dashDriversTbody');
  renderAllDriversTable();
  renderDriverProfiles();
  renderTrips();
  renderTripEvents();
  renderNotifPanel();

  // Activate dashboard nav
  document.querySelector('.nav-item').classList.add('active');

  // Close notif panel on outside click
  document.addEventListener('click', e => {
    if(notifOpen && !document.getElementById('notifPanel').contains(e.target) && !document.getElementById('notifBtn').contains(e.target)) {
      notifOpen = false;
      document.getElementById('notifPanel').classList.remove('open');
    }
  });

  // Draw speed chart after layout
  setTimeout(initSpeedChart, 100);

  // Live simulation every 10 seconds
  setInterval(simulateLiveData, 10000);

  // Welcome toast
  setTimeout(() => showToast('üü¢ SDMS is live ‚Äî 2 drivers active in Calinog, Iloilo.','success'), 800);
});
</script>
</body>
</html>
